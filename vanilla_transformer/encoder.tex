\documentclass[12pt]{article}
\input{bayesuvius.sty}
\begin{document}

\begin{figure}[h!]\centering
\begin{minipage}{.5\linewidth}
\includegraphics[width=2in]{encoder.jpg}
\end{minipage}%blank lines between minispaces breaks this
\begin{minipage}{.5\linewidth}
$$\xymatrix{
*+[F*:Dandelion]{\underline{q}^{(3, 4)}}&*+[F*:Dandelion]{\underline{k}^{(3, 4)}}&&
\\
*+[F*:yellow]{\underline{n}^{(3, 4)}}\ar[u]\ar[ur]&&&
\\
&*+[F*:SkyBlue]{\underline{F}^{(3, 4)}}\ar[ul]&&
\\
*+[F*:yellow]{\underline{N}^{(3, 4)}}\ar[uu]\ar[ur]&&&
\\
&&*+[F*:Dandelion]{\underline{O}^{[D], [L]}}\ar[ull]&
\\
&*+[F*:Dandelion]{\underline{Q}^{[D], [L]}}\ar[ur]&*+[F*:Dandelion]{\underline{K}^{[D], [L]}}\ar[u]&*+[F*:Dandelion]{\underline{V}^{[D],[L]}}\ar[ul]
\\
*+[F*:gray]{\underline{p}^{[L]}}\ar[uuu]\ar[ur]\ar[urr]\ar[urrr]&&&
\\
*+[F*:Lavender]{\underline{x}^{[L]}}\ar[u]&&&
}$$
\end{minipage}
\caption{Encoder.}
\label{fig-texnn-for-encoder}
\end{figure}

\begin{subequations}

\begin{equation}\color{blue}
\underline{q}^{(3, 4)} = \underline{n}^{(3, 4)}
\label{eq-q-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{k}^{(3, 4)} = \underline{n}^{(3, 4)}
\label{eq-k-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{n}^{(3, 4)} = \underline{N}^{(3, 4)},\underline{F}^{(3, 4)}
\label{eq-n-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{F}^{(3, 4)} = \underline{N}^{(3, 4)}
\label{eq-F-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{N}^{(3, 4)} = \underline{p}^{[L]},\underline{O}^{[D], [L]}
\label{eq-N-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{O}^{[D], [L]} = {\rm multi\_headed\_attention}(\underline{Q}^{[D], [L]},\underline{K}^{[D], [L]},\underline{V}^{[D],[L]})
\label{eq-O-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{Q}^{[D], [L]} = W_\rvq^{[D],[d]}E^{[d],[L]}
\label{eq-Q-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{K}^{[D], [L]} = W_\rvk^{[D],[d]}E^{[d],[L]}
\label{eq-K-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{V}^{[D],[L]} = W_\rvv^{[D],[d]}E^{[d],[L]}
\label{eq-V-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{p}^{[L]} = M^{[L], [L]}\underline{x}^{[L]}
\label{eq-p-fun-encoder}
\end{equation}

\begin{equation}\color{blue}
\underline{x}^{[L]} = prior
\label{eq-x-fun-encoder}
\end{equation}

\end{subequations}


\end{document}  
