\documentclass[12pt]{article}
\usepackage[dvipsnames]{xcolor}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[color,matrix,frame,arrow,curve]{xy}
\begin{document}

\begin{figure}[h!]\centering
$$\xymatrix{
&&&*+[F*:purple]{\underline{P}^{3\times  4}}
\\
&*+[F*:green]{\underline{G}^{3\times  4}}\ar[urr]&&
\\
&*+[F*:red]{\underline{R}^{3\times  4}}\ar[u]&&
\\
&*+[F*:yellow]{\underline{Y}^{3\times  4}}\ar[u]&&
\\
&*+[F*:blue]{\underline{B}^{3\times  4}}\ar[u]&&
\\
*+[F*:yellow]{\underline{Q}^{3\times  4}}\ar[ur]&&*+[F*:yellow]{\underline{K}^{3\times  4}}\ar[ul]&*+[F*:yellow]{\underline{V}^{3\times  4}}\ar[uuuuu]
}$$
\caption{Scaled Dot Product Attention.}
\label{fig-texnn-for-scaled-dot_prod_att}
\end{figure}

\begin{subequations}
\begin{equation}
Q^{3\times  4} =)
\label{eq-Q-fun-scaled-dot_prod_att}
\end{equation}

\begin{equation}
K^{3\times  4} =)
\label{eq-K-fun-scaled-dot_prod_att}
\end{equation}

\begin{equation}
V^{3\times  4} =)
\label{eq-V-fun-scaled-dot_prod_att}
\end{equation}

\begin{equation}
B^{3\times  4} = {\rm mat\_mult}(Q^{3\times  4},K^{3\times  4})
\label{eq-B-fun-scaled-dot_prod_att}
\end{equation}

\begin{equation}
Y^{3\times  4} = {\rm scale}(B^{3\times  4})
\label{eq-Y-fun-scaled-dot_prod_att}
\end{equation}

\begin{equation}
R^{3\times  4} = {\rm mask}(Y^{3\times  4})
\label{eq-R-fun-scaled-dot_prod_att}
\end{equation}

\begin{equation}
G^{3\times  4} = {\rm softmax}(R^{3\times  4})
\label{eq-G-fun-scaled-dot_prod_att}
\end{equation}

\begin{equation}
P^{3\times  4} = {\rm mat\_mult}(G^{3\times  4},V^{3\times  4})
\label{eq-P-fun-scaled-dot_prod_att}
\end{equation}

\end{subequations}

\begin{figure}[h!]\centering
$$\xymatrix{
&&&&*+[F*:yellow]{\underline{L}^{3\times  4}}&&&&
\\
&&&&*+[F*:yellow]{\underline{C}^{3\times  4}}\ar[u]&&&&
\\
&*+[F*:blue]{\underline{X}^{3\times  4}}\ar[urrr]&&&*+[F*:blue]{\underline{Y}^{3\times  4}}\ar[u]&&&*+[F*:blue]{\underline{Z}^{3\times  4}}\ar[ulll]&
\\
*+[F*:green]{\underline{1}^{3\times  4}}\ar[ur]\ar[urrrr]\ar[urrrrrrr]&*+[F*:green]{\underline{2}^{3\times  4}}\ar[u]\ar[urrr]\ar[urrrrrr]&*+[F*:green]{\underline{3}^{3\times  4}}\ar[ul]\ar[urr]\ar[urrrrr]&*+[F*:green]{\underline{4}^{3\times  4}}\ar[ull]\ar[ur]\ar[urrrr]&*+[F*:green]{\underline{5}^{3\times  4}}\ar[ulll]\ar[u]\ar[urrr]&*+[F*:green]{\underline{6}^{3\times  4}}\ar[ullll]\ar[ul]\ar[urr]&*+[F*:green]{\underline{7}^{3\times  4}}\ar[ulllll]\ar[ull]\ar[ur]&*+[F*:green]{\underline{8}^{3\times  4}}\ar[ullllll]\ar[ulll]\ar[u]&*+[F*:green]{\underline{9}^{3\times  4}}\ar[ulllllll]\ar[ullll]\ar[ul]
\\
&*+[F*:yellow]{\underline{Q}^{3\times  4}}\ar[ul]\ar[u]\ar[ur]&&&*+[F*:yellow]{\underline{K}^{3\times  4}}\ar[ul]\ar[u]\ar[ur]&&&*+[F*:yellow]{\underline{V}^{3\times  4}}\ar[ul]\ar[u]\ar[ur]&
}$$
\caption{Multi-head Attention.}
\label{fig-texnn-for-multi-head-att}
\end{figure}

\begin{subequations}
\begin{equation}
Q^{3\times  4} =)
\label{eq-Q-fun-multi-head-att}
\end{equation}

\begin{equation}
K^{3\times  4} =)
\label{eq-K-fun-multi-head-att}
\end{equation}

\begin{equation}
V^{3\times  4} =)
\label{eq-V-fun-multi-head-att}
\end{equation}

\begin{equation}
1^{3\times  4} = {\rm linear}(Q^{3\times  4})
\label{eq-1-fun-multi-head-att}
\end{equation}

\begin{equation}
2^{3\times  4} = {\rm linear}(Q^{3\times  4})
\label{eq-2-fun-multi-head-att}
\end{equation}

\begin{equation}
3^{3\times  4} = {\rm linear}(Q^{3\times  4})
\label{eq-3-fun-multi-head-att}
\end{equation}

\begin{equation}
4^{3\times  4} = {\rm linear}(K^{3\times  4})
\label{eq-4-fun-multi-head-att}
\end{equation}

\begin{equation}
5^{3\times  4} = {\rm linear}(K^{3\times  4})
\label{eq-5-fun-multi-head-att}
\end{equation}

\begin{equation}
6^{3\times  4} = {\rm linear}(K^{3\times  4})
\label{eq-6-fun-multi-head-att}
\end{equation}

\begin{equation}
7^{3\times  4} = {\rm linear}(V^{3\times  4})
\label{eq-7-fun-multi-head-att}
\end{equation}

\begin{equation}
8^{3\times  4} = {\rm linear}(V^{3\times  4})
\label{eq-8-fun-multi-head-att}
\end{equation}

\begin{equation}
9^{3\times  4} = {\rm linear}(V^{3\times  4})
\label{eq-9-fun-multi-head-att}
\end{equation}

\begin{equation}
X^{3\times  4} = {\rm scaled\_dot\_prod\_att}(1^{3\times  4},2^{3\times  4},3^{3\times  4},4^{3\times  4},5^{3\times  4},6^{3\times  4},7^{3\times  4},8^{3\times  4},9^{3\times  4})
\label{eq-X-fun-multi-head-att}
\end{equation}

\begin{equation}
Y^{3\times  4} = {\rm scaled\_dot\_prod\_att}(1^{3\times  4},2^{3\times  4},3^{3\times  4},4^{3\times  4},5^{3\times  4},6^{3\times  4},7^{3\times  4},8^{3\times  4},9^{3\times  4})
\label{eq-Y-fun-multi-head-att}
\end{equation}

\begin{equation}
Z^{3\times  4} = {\rm scaled\_dot\_prod\_att}(1^{3\times  4},2^{3\times  4},3^{3\times  4},4^{3\times  4},5^{3\times  4},6^{3\times  4},7^{3\times  4},8^{3\times  4},9^{3\times  4})
\label{eq-Z-fun-multi-head-att}
\end{equation}

\begin{equation}
C^{3\times  4} = {\rm concat}(X^{3\times  4},Y^{3\times  4},Z^{3\times  4})
\label{eq-C-fun-multi-head-att}
\end{equation}

\begin{equation}
L^{3\times  4} = {\rm concat}(C^{3\times  4})
\label{eq-L-fun-multi-head-att}
\end{equation}

\end{subequations}

\begin{figure}[h!]\centering
$$\xymatrix{
&&&&*+[F*:yellow]{\underline{q}^{3\times  4}}
\\
&&&&*+[F*:yellow]{\underline{k}^{3\times  4}}
\\
*+[F*:yellow]{\underline{n}^{3\times  4}}\ar[uurrrr]\ar[urrrr]&&&&
\\
&*+[F*:blue]{\underline{F}^{3\times  4}}\ar[ul]&&&
\\
*+[F*:yellow]{\underline{N}^{3\times  4}}\ar[uu]\ar[ur]&&&&
\\
&&*+[F*:orange]{\underline{O}^{3\times  4}}\ar[ull]&&
\\
&*+[F*:yellow]{\underline{Q}^{3\times  4}}\ar[ur]&*+[F*:yellow]{\underline{K}^{3\times  4}}\ar[u]&*+[F*:yellow]{\underline{V}^{3\times  4}}\ar[ul]&
\\
*+[F*:gray]{\underline{p}^{3\times  4}}\ar[uuu]\ar[ur]\ar[urr]\ar[urrr]&&&&
\\
*+[F*:red]{\underline{R}^{3\times  4}}\ar[u]&&&&
}$$
\caption{Encoder.}
\label{fig-texnn-for-transformer-encoder}
\end{figure}

\begin{subequations}
\begin{equation}
q^{3\times  4} = n^{3\times  4})
\label{eq-q-fun-transformer-encoder}
\end{equation}

\begin{equation}
k^{3\times  4} = n^{3\times  4})
\label{eq-k-fun-transformer-encoder}
\end{equation}

\begin{equation}
n^{3\times  4} = N^{3\times  4},F^{3\times  4})
\label{eq-n-fun-transformer-encoder}
\end{equation}

\begin{equation}
F^{3\times  4} = N^{3\times  4})
\label{eq-F-fun-transformer-encoder}
\end{equation}

\begin{equation}
N^{3\times  4} = p^{3\times  4},O^{3\times  4})
\label{eq-N-fun-transformer-encoder}
\end{equation}

\begin{equation}
O^{3\times  4} = Q^{3\times  4},K^{3\times  4},V^{3\times  4})
\label{eq-O-fun-transformer-encoder}
\end{equation}

\begin{equation}
Q^{3\times  4} = p^{3\times  4})
\label{eq-Q-fun-transformer-encoder}
\end{equation}

\begin{equation}
K^{3\times  4} = p^{3\times  4})
\label{eq-K-fun-transformer-encoder}
\end{equation}

\begin{equation}
V^{3\times  4} = p^{3\times  4})
\label{eq-V-fun-transformer-encoder}
\end{equation}

\begin{equation}
p^{3\times  4} = R^{3\times  4})
\label{eq-p-fun-transformer-encoder}
\end{equation}

\begin{equation}
R^{3\times  4} =)
\label{eq-R-fun-transformer-encoder}
\end{equation}

\end{subequations}


\end{document}
